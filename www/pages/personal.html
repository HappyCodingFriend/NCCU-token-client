<template>
    <section class="page">
        <nav class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">我的帳戶</div>
            </div>
        </nav>
        <div class="page-content">
            <div class="block-title">我的點數</div>
            <div class="list">
                <ul>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title">政大點數</div>
                                <div class="item-after">
                                    <span class="badge" id="">0</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title">宿舍點數</div>
                                <div class="item-after">
                                    <span class="badge" id="dormitory"></span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title">教務處點數</div>
                                <div class="item-after">
                                    <span class="badge" id="academic"></span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title">學務處點數</div>
                                <div class="item-after">
                                    <span class="badge" id="student"></span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!--
                    {{#each data_point}}
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title">{{this[0]}}</div>
                                <div class="item-after">
                                    <span class="badge">{{this[1]}}</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    {{/each}}
                    -->
                </ul>
            </div>
            <div class="block-title">系統</div>
            <div class="list simple-list">
                <ul>
                    <li @click="inf">帳戶資訊</li>
                    <li @click="sign_out">登出</li>
                </ul>
            </div>
        </div>
    </section>
</template>

<script>
    return {
        data: () => {
            return {
                data_point: [
                    ['政大點數', '100點'],
                    ['宿舍點數', '100點'],
                    ['合作社點數', '100點'],
                    ['教務點數', '10點'],
                ]
            }
        },
        methods: {
            inf: () => {
                console.log('inf')
            },
            sign_out: () => {
                console.log('sign_out')
            },
        },
        on: {
            pageMounted: () => {
                console.log('pageMounted')
            },
            pageInit: () => {
                console.log('pageInit')

            },
            pageBeforein: () => {
                console.log('pageBeforein')

                //讀取key file
                window.resolveLocalFileSystemURL(cordova.file.externalDataDirectory, function (dirEntry) {
                    dirEntry.getFile('key.json', { create: true, exclusive: false }, function (fileEntry) {
                        readFile(fileEntry)
                    })
                })

                function readFile(fileEntry) {
                    fileEntry.file(function (file) {
                        let reader = new FileReader()
                        reader.onloadend = keyOnLoadend
                        reader.readAsText(file)
                    }, (evt) => {
                        alert(evt)
                    })
                }

                function keyOnLoadend() {
                    let key = JSON.parse(this.result)

                    $.get(`http://101.0.135.141:50000/query/balance/dormitory?address=${key.address}`, function (result) {
                        console.log(result)
                        $('#dormitory').text(result)
                    })
                    $.get(`http://101.0.135.141:50000/query/balance/academic?address=${key.address}`, function (result) {
                        console.log(result)
                        $('#academic').text(result)
                    })
                    $.get(`http://101.0.135.141:50000/query/balance/student?address=${key.address}`, function (result) {
                        console.log(result)
                        $('#student').text(result)
                    })
                }
            },
            pageBeforeOut: () => {
                console.log('pageBeforeOut')
            },
            pageBeforeRemove: () => {
                console.log('pageBeforeRemove')
            },
        },
    }
</script>