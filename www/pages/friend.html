<template>
    <section class="page">
        <nav class="navbar">
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">好友</div>
                <div class="right">
                    <!-- Link to enable searchbar -->
                    <a class="link icon-only searchbar-enable" data-searchbar=".searchbar">
                        <i class="icon f7-icons ios-only">search_strong</i>
                        <i class="icon material-icons md-only">search</i>
                    </a>
                </div>
                <!-- Searchbar is a direct child of "navbar-inner" -->
                <form class="searchbar searchbar-expandable">
                    <div class="searchbar-inner">
                        <div class="searchbar-input-wrap">
                            <input type="search" placeholder="Search" />
                            <i class="searchbar-icon"></i>
                            <span class="input-clear-button"></span>
                        </div>
                        <span class="searchbar-disable-button">Cancel</span>
                    </div>
                </form>
            </div>
        </nav>
        <div class="fab fab-right-bottom color-blue">
            <a href="#">
                <!-- Icons For iOS Theme -->
                <i class="icon f7-icons ios-only">add</i>
                <i class="icon f7-icons ios-only">close</i>
                <!-- Icons For MD Theme -->
                <i class="icon material-icons md-only">add</i>
                <i class="icon material-icons md-only">close</i>
            </a>
            <!-- FAB speed dial actions -->
            <div class="fab-buttons fab-buttons-top">
                <a @click="addFriend_QR">QR</a>
                <a @click="addFriend_ID">ID</a>
            </div>
        </div>
        <div class="page-content ptr-content" @ptr:refresh="refresh">
            <div class="ptr-preloader">
                <div class="preloader"></div>
                <div class="ptr-arrow"></div>
            </div>
            <div id="friendList" class="list media-list">
            </div>
        </div>
    </section>
</template>

<script>
    function load() {
        let listTemplate = `
            <ul>
                {{#each this}}
                <li>
                    <div class="item-content">
                        <div class="item-media">
                            <img class="head" src="imgs/{{friendID}}.jpg">
                        </div>
                        <div class="item-inner">
                            <div class="item-title-row">
                                <div class="item-title">{{name}}</div>
                                <div class="item-after">大學生</div>
                            </div>
                            <div class="item-subtitle">{{friendID}}</div>
                            <div class="item-text">資訊科學系</div>
                        </div>
                    </div>
                </li>
                {{/each}}
            </ul>
        `
        let compiledListTemplate = Template7.compile(listTemplate)
        $('#friendList').html(compiledListTemplate(friends))
    }
    return {
        data: function () {
        },
        methods: {
            addFriend_QR: () => {

            },
            addFriend_ID: () => {
                app.dialog.prompt('朋友ID?', function (friendID) {
                    api.addFriend(friendID, (data) => {
                        load()
                        app.dialog.alert(data.inf)
                    })
                })
            },
            refresh: (e, done) => {
                api.getFriends(load)
                done()
            },
        },
        on: {
            pageMounted: () => {
                console.group('friend')
            },
            pageInit: () => {
            },
            pageBeforeIn: () => {
                load()
            },
            pageBeforeOut: () => {
            },
            pageBeforeRemove: () => {
                console.groupEnd()
            },
        },
    }
</script>