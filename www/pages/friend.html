<template>
    <section class="page">
        <nav class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">好友</div>
                <div class="subnavbar">
                    <form data-search-container=".virtual-list" data-search-item="li" data-search-in=".item-title" class="searchbar searchbar-init">
                        <div class="searchbar-inner">
                            <div class="searchbar-input-wrap">
                                <input type="search" placeholder="Search" />
                                <i class="searchbar-icon"></i>
                                <span class="input-clear-button"></span>
                            </div>
                            <span class="searchbar-disable-button">Cancel</span>
                        </div>
                    </form>
                </div>
                <div class="right">
                    <a href="#" class="link popover-open" data-popover=".popover-menu">
                        <i class="icon f7-icons ios-only">add</i>
                        <i class="icon material-icons md-only">add</i>
                    </a>
                </div>
            </div>
        </nav>
        <div class="page-content">
            <div class="list simple-list searchbar-not-found">
                <ul>
                    <li>Nothing found</li>
                </ul>
            </div>
            <div class="list virtual-list media-list searchbar-found"></div>
        </div>
        <div class="popover popover-menu">
            <div class="popover-angle"></div>
            <div class="popover-inner">
                <div class="list">
                    <ul>
                        <li>
                            <a href="/dialog/" class="list-button item-link popover-close">掃描QR code</a>
                        </li>
                        <li>
                            <a href="/tabs/" class="list-button item-link popover-close">以帳號新增</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
</template>

<script>
    return {
        data: function () {
        },
        methods: {
        },
        on: {
            pageInit: function () {
                NativeStorage.getItem('user', user => {
                    console.log(user)
                    $.get(`http://101.0.135.141:50000/friends?token=${user.token}`, result => {
                        console.log(result)

                        let virtualList = app.virtualList.create({
                            el: '.virtual-list',
                            items: result,
                            searchAll: function (query, items) {
                                let found = []
                                for (let i = 0; i < items.length; i++) {
                                    if (items[i].name.indexOf(query) >= 0 || query.trim() === '')
                                        found.push(i)
                                }
                                return found
                            },
                            itemTemplate: `
                                        <li>
                                            <div class="item-content">
                                                <div class="item-media">
                                                    <img class="head" src="imgs/{{friendID}}.jpg">
                                                </div>
                                                <div class="item-inner">
                                                    <div class="item-title-row">
                                                        <div class="item-title">{{name}}</div>
                                                        <div class="item-after">大學生</div>
                                                    </div>
                                                    <div class="item-subtitle">{{friendID}}</div>
                                                    <div class="item-text">資訊科學系</div>
                                                </div>
                                            </div>
                                        </li>`,
                        })
                    })
                }, err => {
                    console.error(err)
                    app.dialog.alert('請先登入', '政大錢包', () => {
                        app.router.back()
                    })
                })
            },
            pageBeforeOut: function () {
            },
            pageBeforeRemove: function () {
            },
        },
    }
</script>