<template>
    <section class="page">
        <nav class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">明細</div>
            </div>
        </nav>
        <div class="page-content">
            <div class="block-title">付款</div>
            <div class="list virtual-list1">
            </div>
            <div class="block-title">收款</div>
            <div class="list virtual-list2">
            </div>
        </div>
        <!--明細內容-->
        <div class="popup detail-popup">
            <div class="page">
                <div class="navbar">
                    <div class="navbar-inner">
                        <div class="title">明細內容</div>
                        <div class="right">
                            <a href="#" class="link popup-close">關閉</a>
                        </div>
                    </div>
                </div>
                <div class="page-content">
                    <div class="list">
                        <ul>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">轉出帳戶</div>
                                        <div class="item-after">王小明/10159001</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">轉入帳戶</div>
                                        <div class="item-after">王小明/10159002</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">交易類別</div>
                                        <div class="item-after">轉帳</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">點數種類</div>
                                        <div class="item-after">教務點數</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">交易金額</div>
                                        <div class="item-after">+20</div>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="item-content">
                                    <div class="item-inner">
                                        <div class="item-title">交易狀態</div>
                                        <div class="item-after">成功</div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>

<script>
    return {
        methods: {},
        on: {
            pageInit: () => {
                NativeStorage.getItem('user', user => {
                    console.log(user)
                    $.get(`http://101.0.135.141:50000/query/transactionsTo?token=${user.token}`, result => {
                        console.log(result)

                        result.forEach(element => {
                            element.date = new Date(element.timestamp).toISOString().slice(0, 10).replace(/-/g, "")
                        })

                        let virtualList = app.virtualList.create({
                            el: '.virtual-list1',
                            items: result,
                            itemTemplate: `
                                <li>
                                    <a href="#" class="item-link item-content popup-open" data-popup=".detail-popup">
                                        <div class="item-media">
                                            {{date}}
                                        </div>
                                        <div class="item-inner">
                                            <div class="item-title">
                                                <div class="item-header">{{targetID}}</div>
                                                {{ercName}}
                                            </div>
                                            <div class="item-after">
                                                <span class="badge color-red">{{number}}</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            `,
                            height: 54
                        })
                    })
                    $.get(`http://101.0.135.141:50000/query/transactionsFrom?token=${user.token}`, result => {
                        console.log(result)

                        result.forEach(element => {
                            element.date = new Date(element.timestamp).toISOString().slice(0, 10).replace(/-/g, "")
                        })

                        let virtualList = app.virtualList.create({
                            el: '.virtual-list2',
                            items: result,
                            itemTemplate: `
                                <li>
                                    <a href="#" class="item-link item-content popup-open" data-popup=".detail-popup">
                                        <div class="item-media">
                                            {{date}}
                                        </div>
                                        <div class="item-inner">
                                            <div class="item-title">
                                                <div class="item-header">{{targetID}}</div>
                                                {{ercName}}
                                            </div>
                                            <div class="item-after">
                                                <span class="badge color-green">{{number}}</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            `,
                            height: 54
                        })
                    })
                }, err => {
                    console.error(err)
                    app.dialog.alert('請先登入', '政大錢包', () => {
                        app.router.back()
                    })
                })
            },
            pageBeforeOut: function () { },
            pageBeforeRemove: function () { },
        },
    }
</script>